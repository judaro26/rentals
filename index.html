<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Affordable Property Rentals</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600;700&family=Playfair+Display:wght@400;700&display=swap" rel="stylesheet">
<style>
    :root {
        --primary: #2c3e50;
        --secondary: #3498db;
        --accent: #e74c3c;
        --light: #ecf0f1;
        --dark: #2c3e50;
        --success: #2ecc71;
        --transition: all 0.3s ease;
        --shadow: 0 10px 30px -10px rgba(0, 0, 0, 0.2);
        --radius: 12px;
    }
    
    * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
    }
    
    html {
        scroll-behavior: smooth;
    }
    
    body {
        font-family: 'Montserrat', sans-serif;
        background-color: #f9f9f9;
        color: var(--dark);
        line-height: 1.6;
    }
    
    h1, h2, h3 {
        font-family: 'Playfair Display', serif;
        font-weight: 700;
    }
    
    *:focus-visible {
        outline: 3px solid var(--accent);
        outline-offset: 2px;
    }
    
    .hidden {
        display: none !important;
    }
    
    /* Language Modal */
    #languageModal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: linear-gradient(135deg, rgba(44,62,80,0.95) 0%, rgba(52,152,219,0.95) 100%);
        display: none;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        z-index: 1000;
        color: white;
        animation: fadeIn 0.5s ease;
    }
    
    #languageModal h2 {
        margin-bottom: 2rem;
        font-size: 2.5rem;
        text-align: center;
        text-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }
    
    .language-buttons {
        display: flex;
        gap: 1.5rem;
    }
    
    .lang-btn {
        padding: 1rem 2rem;
        font-size: 1.1rem;
        background: rgba(255,255,255,0.1);
        color: white;
        border: 2px solid white;
        border-radius: var(--radius);
        cursor: pointer;
        min-width: 180px;
        transition: var(--transition);
        backdrop-filter: blur(5px);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.5rem;
    }
    
    .lang-btn:hover {
        background: rgba(255,255,255,0.2);
        transform: translateY(-3px);
        box-shadow: var(--shadow);
    }
    
    /* Main Container */
    .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem;
    }
    
    /* Prompt Screen */
    #promptScreen {
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
        min-height: 80vh;
        text-align: center;
        animation: fadeInUp 0.6s ease;
    }
    
    #promptTitle {
        font-size: 2.8rem;
        margin-bottom: 3rem;
        color: var(--primary);
        position: relative;
        display: inline-block;
    }
    
    #promptTitle::after {
        content: '';
        position: absolute;
        bottom: -15px;
        left: 50%;
        transform: translateX(-50%);
        width: 80px;
        height: 4px;
        background: var(--accent);
        border-radius: 2px;
    }
    
    .action-buttons {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 3rem;
        flex-wrap: wrap;
        justify-content: center;
    }
    
    .action-btn {
        padding: 1.2rem 2.5rem;
        font-size: 1.1rem;
        font-weight: 600;
        background: var(--secondary);
        color: white;
        border: none;
        border-radius: var(--radius);
        cursor: pointer;
        transition: var(--transition);
        display: flex;
        align-items: center;
        gap: 0.7rem;
        box-shadow: var(--shadow);
    }
    
    .action-btn:hover {
        background: #2980b9;
        transform: translateY(-3px);
        box-shadow: 0 15px 30px -10px rgba(0, 0, 0, 0.2);
    }
    
    .action-btn i {
        font-size: 1.3rem;
    }
    
    /* Gallery Page */
    #mainPage {
        padding: 4rem 0;
        animation: fadeIn 0.6s ease;
    }
    
    #galleryTitle {
        text-align: center;
        font-size: 2.5rem;
        margin-bottom: 3rem;
        color: var(--primary);
    }
    
    .property-cards {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
        gap: 2rem;
        margin-bottom: 3rem;
    }
    
    .property-card {
        background: white;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        transition: var(--transition);
    }
    
    .property-card:hover {
        transform: translateY(-10px);
        box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
    }
    
    .property-img {
        height: 200px;
        background-size: cover;
        background-position: center;
    }
    
    .property-info {
        padding: 1.5rem;
    }
    
    .property-info h3 {
        font-size: 1.5rem;
        margin-bottom: 0.5rem;
        color: var(--primary);
    }
    
    .property-info p {
        color: #7f8c8d;
        margin-bottom: 1.5rem;
    }
    
    .view-btn {
        display: inline-block;
        padding: 0.8rem 1.5rem;
        background: var(--secondary);
        color: white;
        border-radius: 50px;
        text-decoration: none;
        font-weight: 600;
        transition: var(--transition);
    }
    
    .view-btn:hover {
        background: #2980b9;
        transform: translateY(-2px);
    }
    
    /* Application Form */
    #applicationForm {
        max-width: 700px;
        margin: 3rem auto;
        padding: 3rem;
        background: white;
        border-radius: var(--radius);
        box-shadow: var(--shadow);
        animation: fadeInUp 0.6s ease;
    }
    
    #formTitle {
        text-align: center;
        font-size: 2.2rem;
        margin-bottom: 2rem;
        color: var(--primary);
    }
    
    /* Enhanced Form Styles */
    .form-section {
        border: 1px solid #e0e0e0;
        border-radius: var(--radius);
        padding: 1.5rem;
        margin-bottom: 2rem;
        background: #f9f9f9;
    }
    
    .form-section legend {
        font-weight: 700;
        color: var(--primary);
        padding: 0 0.5rem;
        width: auto;
    }
    
    .form-group {
        margin-bottom: 1.5rem;
    }
    
    .form-group label {
        display: block;
        margin-bottom: 0.5rem;
        font-weight: 600;
        color: var(--dark);
    }
    
    .form-control {
        width: 100%;
        padding: 1rem;
        border: 1px solid #ddd;
        border-radius: var(--radius);
        font-size: 1rem;
        transition: var(--transition);
    }
    
    .form-control:focus {
        border-color: var(--secondary);
        outline: none;
        box-shadow: 0 0 0 3px rgba(52,152,219,0.2);
    }
    
    .form-row {
        display: flex;
        gap: 1.5rem;
        margin-bottom: 1rem;
    }
    
    .form-row .form-group {
        flex: 1;
    }
    
    .input-group {
        display: flex;
        align-items: center;
    }
    
    .input-group-text {
        padding: 0.75rem;
        background: #e9ecef;
        border: 1px solid #ced4da;
        border-right: none;
        border-radius: var(--radius) 0 0 var(--radius);
    }
    
    .input-group .form-control {
        border-radius: 0 var(--radius) var(--radius) 0;
    }
    
    .form-check {
        margin-bottom: 0.5rem;
    }
    
    .form-check-input {
        margin-right: 0.5rem;
    }
    
    .submit-btn {
        width: 100%;
        padding: 1.2rem;
        background: var(--success);
        color: white;
        border: none;
        border-radius: var(--radius);
        font-size: 1.1rem;
        font-weight: 600;
        cursor: pointer;
        transition: var(--transition);
        margin-top: 1rem;
    }
    
    .submit-btn:hover {
        background: #27ae60;
        transform: translateY(-2px);
        box-shadow: var(--shadow);
    }
    
    .form-actions {
        display: flex;
        justify-content: space-between;
        margin-top: 2rem;
    }
    
    /* Conditional fields */
    #petDetails {
        padding: 1rem;
        background: #f0f8ff;
        border-radius: var(--radius);
        margin-top: 1rem;
    }
    
    /* Slideshow */
    #slideshow {
        max-width: 900px;
        margin: 3rem auto;
        animation: fadeIn 0.6s ease;
    }
    
    #slidesContainer {
        background: white;
        border-radius: var(--radius);
        overflow: hidden;
        box-shadow: var(--shadow);
        padding: 2rem;
    }
    
    #slidesContainer img {
        width: 100%;
        max-height: 500px;
        object-fit: contain;
        border-radius: calc(var(--radius) - 5px);
        margin-bottom: 1.5rem;
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    .caption {
        font-size: 1.4rem;
        font-weight: 600;
        color: var(--primary);
        margin-bottom: 2rem;
        text-align: center;
    }
    
    .slide-nav {
        display: flex;
        justify-content: center;
        gap: 1rem;
        margin-top: 1.5rem;
    }
    
    .slide-btn {
        padding: 0.8rem 1.5rem;
        background: var(--secondary);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
    }
    
    .slide-btn:disabled {
        background: #bdc3c7;
        cursor: not-allowed;
        transform: none !important;
    }
    
    .slide-btn:hover:not(:disabled) {
        background: #2980b9;
        transform: translateY(-2px);
    }
    
    /* Back Button */
    .back-btn {
        display: inline-flex;
        align-items: center;
        padding: 0.8rem 1.5rem;
        background: var(--light);
        color: var(--dark);
        border: none;
        border-radius: 50px;
        cursor: pointer;
        transition: var(--transition);
        font-weight: 600;
        margin: 2rem auto;
        text-decoration: none;
    }
    
    .back-btn i {
        margin-right: 0.5rem;
    }
    
    .back-btn:hover {
        background: #d5dbdb;
        transform: translateY(-2px);
        box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }
    
    /* Loading Spinner */
    @keyframes spin {
        to { transform: rotate(360deg); }
    }
    
    .loading-spinner {
        display: inline-block;
        width: 24px;
        height: 24px;
        border: 3px solid rgba(255,255,255,0.3);
        border-radius: 50%;
        border-top-color: white;
        animation: spin 1s ease-in-out infinite;
        vertical-align: middle;
        margin-left: 8px;
    }
    
    /* Footer */
    footer {
        text-align: center;
        padding: 2rem;
        background: var(--primary);
        color: white;
        margin-top: 3rem;
    }
    
    /* Animations */
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }
    
    @keyframes fadeInUp {
        from { 
            opacity: 0;
            transform: translateY(20px);
        }
        to { 
            opacity: 1;
            transform: translateY(0);
        }
    }
    
    /* Print Styles */
    @media print {
        .back-btn, .action-btn, .lang-btn {
            display: none !important;
        }
        
        body {
            background: white !important;
            color: black !important;
            font-size: 12pt;
        }
        
        .form-section {
            break-inside: avoid;
            border: none;
            background: white !important;
        }
        
        #applicationForm {
            box-shadow: none;
            padding: 0;
            max-width: 100%;
        }
    }
    
    /* Responsive Adjustments */
    @media (max-width: 768px) {
        #promptTitle, #galleryTitle, #formTitle {
            font-size: 2rem;
        }
        
        .language-buttons, .action-buttons {
            flex-direction: column;
            width: 100%;
        }
        
        .lang-btn, .action-btn {
            width: 100%;
        }
        
        #applicationForm {
            padding: 2rem 1.5rem;
        }
        
        .form-row {
            flex-direction: column;
            gap: 1rem;
        }
        
        .form-actions {
            flex-direction: column-reverse;
            gap: 1rem;
        }
        
        .submit-btn, .back-btn {
            width: 100%;
        }
    }
    
    @media (max-width: 480px) {
        :root {
            --radius: 8px;
        }
        
        .container {
            padding: 1rem;
        }
        
        #applicationForm, #slidesContainer {
            padding: 1.5rem 1rem;
        }
    }

    /* Location Selection Styles */
    #locationScreen {
      padding: 4rem 0;
      animation: fadeIn 0.6s ease;
    }
    
    #locationTitle {
      text-align: center;
      font-size: 2.5rem;
      margin-bottom: 3rem;
      color: var(--primary);
    }
    
    .location-cards {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 2rem;
      margin-bottom: 3rem;
    }
    
    .location-card {
      background: white;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow);
      transition: var(--transition);
      cursor: pointer;
    }
    
    .location-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 20px 40px -10px rgba(0, 0, 0, 0.2);
    }
    
    .location-img {
      height: 200px;
      background-size: cover;
      background-position: center;
    }
    
    .location-info {
      padding: 1.5rem;
      text-align: center;
    }
    
    .location-info h3 {
      font-size: 1.5rem;
      margin-bottom: 1.5rem;
      color: var(--primary);
    }
    
    .select-btn {
      display: inline-block;
      padding: 0.8rem 1.5rem;
      background: var(--secondary);
      color: white;
      border-radius: 50px;
      text-decoration: none;
      font-weight: 600;
      transition: var(--transition);
      border: none;
      cursor: pointer;
    }
    
    .select-btn:hover {
      background: #2980b9;
      transform: translateY(-2px);
    }
/* Success Message Styles */
#form-messages {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.8);
  display: none;
  justify-content: center;
  align-items: center;
  z-index: 1000;
}

.success-message {
  background: white;
  padding: 3rem;
  border-radius: var(--radius);
  text-align: center;
  max-width: 600px;
  box-shadow: var(--shadow);
}

.success-message i {
  color: var(--success);
  font-size: 4rem;
  margin-bottom: 1.5rem;
}
/* Add to your existing styles */
.error-message {
  background: white;
  padding: 3rem;
  border-radius: var(--radius);
  text-align: center;
  max-width: 600px;
  box-shadow: var(--shadow);
}

.error-message i {
  color: var(--accent);
  font-size: 4rem;
  margin-bottom: 1.5rem;
}

.error-message h2 {
  color: var(--primary);
  margin-bottom: 1rem;
}

.error-message p {
  margin-bottom: 2rem;
  color: var(--dark);
}
/* Smaller title for Fairfield properties */
#fairfieldProperties .property-info h3 {
  font-size: 1.3rem; /* Adjust the size as needed */
}

</style>
</head>
<body>
    <!-- Language Selection Modal -->
    <div id="languageModal">
        <h2>Select Your Language<br>Seleccione su Idioma</h2>
        <div class="language-buttons">
            <button class="lang-btn" onclick="setLanguage('en')">
                <i class="fas fa-language"></i> English
            </button>
            <button class="lang-btn" onclick="setLanguage('es')">
                <i class="fas fa-language"></i> Español
            </button>
        </div>
    </div>

    <!-- Property Selection -->
    <section id="locationScreen" class="hidden">
      <div class="container">
        <h2 id="locationTitle">Select Location</h2>
        <div class="location-cards">
          <div class="location-card" onclick="selectLocation('stockton')">
            <div class="location-img" style="background-image: url('images/main1.jpg');"></div>
            <div class="location-info">
              <h3>Stockton, CA</h3>
              <button class="select-btn">View Properties</button>
            </div>
          </div>
          <div class="location-card" onclick="selectLocation('fairfield')">
            <div class="location-img" style="background-image: url('images/fairfield/fairfield.jpg');"></div>
            <div class="location-info">
              <h3>Fairfield, CA</h3>
              <button class="select-btn">View Properties</button>
            </div>
          </div>
        </div>
        <button class="back-btn" onclick="goBackToLanguage()">
          <i class="fas fa-arrow-left"></i> Back
        </button>
      </div>
    </section>

    <!-- Prompt Screen -->
    <section id="promptScreen" class="hidden">
        <div class="container">
            <h2 id="promptTitle">What would you like to do?</h2>
            <div class="action-buttons">
                <button id="viewImagesBtn" class="action-btn" onclick="goToGallery()">
                    <i class="fas fa-images"></i> View Images
                </button>
                <button id="applyNowBtn" class="action-btn" onclick="goToApplication()">
                    <i class="fas fa-file-signature"></i> Apply for Property
                </button>
            </div>
            <button class="back-btn" onclick="goBack()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
    </section>

    <!-- Gallery Page -->
    <section id="mainPage" class="hidden">
        <div class="container">
            <h2 id="galleryTitle">Our Properties</h2>
            <div class="property-cards">
                <div class="property-card">
                    <div class="property-img" style="background-image: url('images/main1.jpg');"></div>
                    <div class="property-info">
                        <h3 id="mainHouseBtn">Main House</h3>
                        <p id="mainHouseDesc">2 Bed / 1 Bath - $1950/mo</p>
                        <button class="view-btn" onclick="viewPropertyGallery('stockton', 'main')">
                            View Gallery
                        </button>
                    </div>
                </div>
                <div class="property-card">
                    <div class="property-img" style="background-image: url('images/studio1.jpg');"></div>
                    <div class="property-info">
                        <h3 id="studioBtn">Studio</h3>
                        <p id="studioDesc">1 Bed / 1 Bath - $950/mo</p>
                        <button class="view-btn" onclick="viewPropertyGallery('stockton', 'studio')">
                            View Gallery
                        </button>
                    </div>
                </div>
            </div>
            <button class="back-btn" onclick="goBackToPrompt()">
                <i class="fas fa-arrow-left"></i> Back
            </button>
        </div>
    </section>

    <!-- Application Form with Netlify -->
    <section id="applicationForm" class="hidden">
        <div class="container">
            <h2 id="formTitle">Rental Application</h2>
            <form name="rental-application"
                  method="POST"
                  netlify
                  data-netlify="true"
                  data-netlify-honeypot="bot-field"
                  action="/?form-submitted=true#form-messages">
                <input type="hidden" name="form-name" value="rental-application">
                <p class="hidden">
                    <label>Don't fill this out if you're human: <input name="bot-field"></label>
                </p>
                
                <!-- Hidden property info -->
                <input type="hidden" name="property-location" id="propertyLocation">
                <input type="hidden" name="property-type" id="propertyType">
                <input type="hidden" name="language" id="formLanguage">

                <!-- Personal Information Section -->
                <fieldset class="form-section">
                    <legend id="personalInfoTitle">Personal Information</legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="firstName" id="firstNameLabel">First Name</label>
                            <input type="text" id="firstName" class="form-control" required name="first-name">
                        </div>
                        <div class="form-group">
                            <label for="lastName" id="lastNameLabel">Last Name</label>
                            <input type="text" id="lastName" class="form-control" required name="last-name">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="dob" id="dobLabel">Date of Birth</label>
                            <input type="date" id="dob" class="form-control" required name="date-of-birth">
                        </div>
                        <div class="form-group">
                            <label for="ssn" id="ssnLabel">SSN (Last 4 Digits)</label>
                            <input type="text" id="ssn" class="form-control" pattern="\d{4}" maxlength="4" required name="ssn-last-four">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="email" id="emailLabel">Email Address</label>
                            <input type="email" id="email" class="form-control" required name="email">
                        </div>
                        <div class="form-group">
                            <label for="phone" id="phoneLabel">Phone Number</label>
                            <input type="tel" id="phone" class="form-control" required name="phone">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="currentAddress" id="currentAddressLabel">Current Address</label>
                        <textarea id="currentAddress" class="form-control" rows="2" required name="current-address"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="currentRent" id="currentRentLabel">Current Rent Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" id="currentRent" class="form-control" min="0" required name="current-rent">
                            </div>
                        </div>
                        <div class="form-group">
                            <label for="moveInDate" id="moveInDateLabel">Desired Move-In Date</label>
                            <input type="date" id="moveInDate" class="form-control" required name="move-in-date">
                        </div>
                    </div>
                </fieldset>
                
                <!-- Employment Information -->
                <fieldset class="form-section">
                    <legend id="employmentTitle">Employment Information</legend>
                    
                    <div class="form-group">
                        <label for="employerName" id="employerNameLabel">Current Employer</label>
                        <input type="text" id="employerName" class="form-control" required name="employer-name">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="jobTitle" id="jobTitleLabel">Job Title</label>
                            <input type="text" id="jobTitle" class="form-control" required name="job-title">
                        </div>
                        <div class="form-group">
                            <label for="employmentDuration" id="employmentDurationLabel">Duration of Employment</label>
                            <input type="text" id="employmentDuration" class="form-control" placeholder="e.g., 2 years" required name="employment-duration">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="employerAddress" id="employerAddressLabel">Employer Address</label>
                        <textarea id="employerAddress" class="form-control" rows="2" required name="employer-address"></textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="supervisorName" id="supervisorNameLabel">Supervisor Name</label>
                            <input type="text" id="supervisorName" class="form-control" required name="supervisor-name">
                        </div>
                        <div class="form-group">
                            <label for="supervisorPhone" id="supervisorPhoneLabel">Supervisor Phone</label>
                            <input type="tel" id="supervisorPhone" class="form-control" required name="supervisor-phone">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="monthlyIncome" id="monthlyIncomeLabel">Gross Monthly Income</label>
                        <div class="input-group">
                            <span class="input-group-text">$</span>
                            <input type="number" id="monthlyIncome" class="form-control" min="0" required name="monthly-income">
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label id="incomeProofLabel">Proof of Income</label>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="payStubs" name="pay-stubs" value="yes">
                            <label class="form-check-label" for="payStubs" data-translate="payStubs"></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="bankStatements" name="bank-statements" value="yes">
                            <label class="form-check-label" for="bankStatements" data-translate="bankStatements"></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="taxReturns" name="tax-returns" value="yes">
                            <label class="form-check-label" for="taxReturns" data-translate="taxReturns"></label>
                        </div>
                    </div>
                </fieldset>
                
                <!-- Rental History -->
                <fieldset class="form-section">
                    <legend id="rentalHistoryTitle">Rental History</legend>
                    
                    <div class="form-group">
                        <label for="previousLandlord" id="previousLandlordLabel">Previous Landlord Name</label>
                        <input type="text" id="previousLandlord" class="form-control" data-translate="previousLandlord">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="previousLandlordPhone" id="previousLandlordPhoneLabel">Landlord Phone</label>
                            <input type="tel" id="previousLandlordPhone" class="form-control" data-translate="previousLandlordPhone">
                        </div>
                        <div class="form-group">
                            <label for="previousRent" id="previousRentLabel">Previous Rent Amount</label>
                            <div class="input-group">
                                <span class="input-group-text">$</span>
                                <input type="number" id="previousRent" class="form-control" min="0" data-translate="previousRent">
                            </div>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="reasonForLeaving" id="reasonForLeavingLabel">Reason for Leaving</label>
                        <textarea id="reasonForLeaving" class="form-control" rows="2" data-translate="reasonForLeaving"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label id="evictionLabel">Have you ever been evicted?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="eviction" id="evictionYes" value="yes">
                            <label class="form-check-label" for="evictionYes" data-translate="evictionYes"></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="eviction" id="evictionNo" value="no" checked>
                            <label class="form-check-label" for="evictionNo" data-translate="evictionNo"></label>
                        </div>
                    </div>
                </fieldset>
                
                <!-- Vehicle Information -->
                <fieldset class="form-section">
                    <legend id="vehicleTitle">Vehicle Information</legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="make" id="makeLabel">Make</label>
                            <input type="text" id="make" class="form-control" data-translate="make">
                        </div>
                        <div class="form-group">
                            <label for="model" id="modelLabel">Model</label>
                            <input type="text" id="model" class="form-control" data-translate="model">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="year" id="yearLabel">Year</label>
                            <input type="number" id="year" class="form-control" min="1900" max="2023" data-translate="year">
                        </div>
                        <div class="form-group">
                            <label for="licensePlate" id="licensePlateLabel">License Plate</label>
                            <input type="text" id="licensePlate" class="form-control" data-translate="licensePlate">
                        </div>
                    </div>
                </fieldset>
                
                <!-- Emergency Contact -->
                <fieldset class="form-section">
                    <legend id="emergencyContactTitle">Emergency Contact</legend>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emergencyName" id="emergencyNameLabel">Full Name</label>
                            <input type="text" id="emergencyName" class="form-control" required data-translate="emergencyName">
                        </div>
                        <div class="form-group">
                            <label for="emergencyRelation" id="emergencyRelationLabel">Relationship</label>
                            <input type="text" id="emergencyRelation" class="form-control" required data-translate="emergencyRelation">
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label for="emergencyPhone" id="emergencyPhoneLabel">Phone Number</label>
                            <input type="tel" id="emergencyPhone" class="form-control" required data-translate="emergencyPhone">
                        </div>
                        <div class="form-group">
                            <label for="emergencyEmail" id="emergencyEmailLabel">Email</label>
                            <input type="email" id="emergencyEmail" class="form-control" data-translate="emergencyEmail">
                        </div>
                    </div>
                </fieldset>
                
                <!-- Additional Information -->
                <fieldset class="form-section">
                    <legend id="additionalInfoTitle">Additional Information</legend>
                    
                    <div class="form-group">
                        <label for="occupants" id="occupantsLabel">Number of Occupants</label>
                        <input type="number" id="occupants" class="form-control" min="1" required data-translate="occupants">
                    </div>
                    
                    <div class="form-group">
                        <label id="petsLabel">Will you have pets?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="pets" id="petsYes" value="yes">
                            <label class="form-check-label" for="petsYes" data-translate="petsYes"></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="pets" id="petsNo" value="no" checked>
                            <label class="form-check-label" for="petsNo" data-translate="petsNo"></label>
                        </div>
                    </div>
                    
                    <div class="form-group" id="petDetails" style="display: none;">
                        <label for="petDescription" id="petDescriptionLabel">Pet Description (Type, Breed, Weight)</label>
                        <textarea id="petDescription" class="form-control" rows="2" data-translate="petDescription"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label id="smokingLabel">Do you smoke?</label>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="smoking" id="smokingYes" value="yes">
                            <label class="form-check-label" for="smokingYes" data-translate="smokingYes"></label>
                        </div>
                        <div class="form-check">
                            <input class="form-check-input" type="radio" name="smoking" id="smokingNo" value="no" checked>
                            <label class="form-check-label" for="smokingNo" data-translate="smokingNo"></label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label for="additionalInfo" id="additionalInfoLabel">Additional Comments</label>
                        <textarea id="additionalInfo" class="form-control" rows="3" data-translate="additionalInfo"></textarea>
                    </div>
                </fieldset>
                
                <!-- Terms and Conditions -->
                <fieldset class="form-section">
                    <legend id="termsTitle">Terms & Conditions</legend>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="creditCheck" required>
                            <label class="form-check-label" for="creditCheck" data-translate="creditCheck"></label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="termsAgreement" required>
                            <label class="form-check-label" for="termsAgreement" data-translate="termsAgreement"></label>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="stocktonDisclosure" required>
                            <label class="form-check-label" for="stocktonDisclosure" data-translate="stocktonDisclosure"></label>
                        </div>
                    </div>
                </fieldset>
                
                     <div class="form-actions">
                    <button type="submit" class="submit-btn" id="submitApplicationBtn">
                        <i class="fas fa-paper-plane"></i> <span data-translate="submitBtn">Submit Application</span>
                    </button>
                    <button type="button" class="back-btn" onclick="showPromptScreen()">
                        <i class="fas fa-arrow-left"></i> <span data-translate="back">Back</span>
                    </button>
                </div>
            </form>
        </div>
    </section>

        <!-- Form Submission Messages -->
    <div id="form-success" class="hidden">
        <div class="container">
            <h2>Thank You!</h2>
            <p>Your application has been submitted successfully.</p>
            <button class="back-btn" onclick="showPromptScreen()">
                <i class="fas fa-arrow-left"></i> Back to Main Menu
            </button>
        </div>
    </div>

    <div id="form-error" class="hidden">
        <div class="container">
            <h2>Submission Error</h2>
            <p>There was an error submitting your application. Please try again.</p>
            <button class="back-btn" onclick="showPromptScreen()">
                <i class="fas fa-arrow-left"></i> Back to Main Menu
            </button>
        </div>
        <!-- Form Submission Messages -->
    <div id="form-messages" class="hidden">
      <div class="success-message">
        <i class="fas fa-check-circle"></i>
        <h2>Application Submitted!</h2>
        <p>Thank you for your application. We'll review your information and contact you soon.</p>
        <button onclick="resetApplicationFlow()" class="back-btn">
          <i class="fas fa-home"></i> Back to Main Page
        </button>
      </div>
    </div>
    </div>

    
                    
    <!-- Slideshow -->
    <section id="slideshow" class="hidden">
        <div class="container">
            <div id="slidesContainer"></div>
        </div>
    </section>

    <footer>
        <p>&copy; 2023 Luxury Property Rentals. All rights reserved.</p>
    </footer>

    <script src="script.js"></script>
<script>
<script>
// Track if we've shown the success message
let hasShownSuccess = false;

// Language variable should be declared at the top level
let language = localStorage.getItem("lang") || 'en'; // Only ONE declaration here

function showFormMessages() {
  const urlParams = new URLSearchParams(window.location.search);
  if (urlParams.get('form-submitted') === 'true' && !hasShownSuccess) {
    document.getElementById('form-messages')?.classList.remove('hidden');
    hasShownSuccess = true;
    sessionStorage.setItem('formSubmitted', 'true');
    history.replaceState(null, null, window.location.pathname); // Clear the parameter
  } else if (sessionStorage.getItem('formSubmitted') === 'true' && !hasShownSuccess) {
    document.getElementById('form-messages')?.classList.remove('hidden');
    hasShownSuccess = true;
  }
}

function resetApplicationFlow() {
  document.getElementById('form-messages')?.classList.add('hidden');
  document.getElementById('languageModal').style.display = 'flex';
  document.getElementById('applicationForm').classList.add('hidden');
  document.getElementById('promptScreen').classList.add('hidden');
  document.getElementById('locationScreen').classList.add('hidden');
  document.getElementById('mainPage').classList.add('hidden');
  document.getElementById('slideshow').classList.add('hidden');
  sessionStorage.removeItem('formSubmitted');
  hasShownSuccess = false;
}

async function handleRentalApplicationSubmit(e) {
  e.preventDefault();
  const form = e.target;
  const submitBtn = document.getElementById('submitApplicationBtn');
  if (!form || !submitBtn) return;

  const originalText = submitBtn.innerHTML;
  submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
  submitBtn.disabled = true;

  try {
    const formData = new FormData(form);

    const netlifyResponse = await fetch(form.action, {
      method: 'POST',
      body: formData
    });

    if (!netlifyResponse.ok) {
      throw new Error('Netlify form submission failed');
    }

    const pdfResponse = await fetch('/.netlify/functions/generate-pdf', {
      method: 'POST',
      body: JSON.stringify({
        payload: {
          data: Object.fromEntries(formData)
        }
      }),
      headers: {
        'Content-Type': 'application/json'
      }
    });

    const result = await pdfResponse.json();

    if (pdfResponse.ok) {
      const link = document.createElement('a');
      link.href = `data:application/pdf;base64,${result.pdf}`;
      link.download = result.filename || `application_${Date.now()}.pdf`;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);

      document.getElementById('form-messages')?.classList.remove('hidden');
      hasShownSuccess = true;
    } else {
      throw new Error(result.error || 'PDF generation failed');
    }
  } catch (error) {
    console.error('Error:', error);
    alert(language === 'es'
      ? 'Error al enviar la solicitud. Por favor intente nuevamente.'
      : 'Error submitting application. Please try again.');
  } finally {
    submitBtn.innerHTML = originalText;
    submitBtn.disabled = false;

    if (hasShownSuccess) {
      form.reset();

      if (currentLocation === 'stockton') {
        showPromptScreen();
      } else {
        showPropertiesForLocation(currentLocation);
      }
    }
  }
}

document.addEventListener('DOMContentLoaded', function() {
  // Initialize form submission
  const form = document.getElementById('rentalApplication');
  if (form) {
    form.addEventListener('submit', handleRentalApplicationSubmit);
  }

  // Show form messages if needed
  showFormMessages();

  // Pet details toggle
  document.querySelectorAll('input[name="pets"]').forEach(radio => {
    radio.addEventListener('change', function() {
      const petDetails = document.getElementById('petDetails');
      if (petDetails) {
        petDetails.style.display = this.value === 'yes' ? 'block' : 'none';
      }
    });
  });
});
</script>
</body>
</html>
